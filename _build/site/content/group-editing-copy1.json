{"version":2,"kind":"Notebook","sha256":"a90a819b782c9f9459a22509a59342b93e09e5edfe45d5aec5be79b8ef7143a5","slug":"group-editing-copy1","location":"/content/group_editing-Copy1.ipynb","dependencies":[],"frontmatter":{"title":"üï∞Ô∏è ALL ABOUT DURATIONS AND SEGMENTATION IN THE PYSCENE DATA üï∞Ô∏è","content_includes_title":false,"kernelspec":{"name":"friends","display_name":"Python (friends)","language":"python"},"github":"https://github.com/brainhack-school2025/analyses_friends_annotations","keywords":[],"edit_url":"https://github.com/brainhack-school2025/analyses_friends_annotations/blob/main/content/group_editing-Copy1.ipynb","exports":[{"format":"ipynb","filename":"group_editing-Copy1.ipynb","url":"/group_editing-Copy1-77f70f6eaaf3e80c603e58a47298e71f.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt","visibility":"hide","key":"hQ0X7QbulY"},{"type":"output","id":"kdT1Ff0pmW29Yk5TfMoHx","data":[],"visibility":"show","key":"YCiFoHneiG"}],"visibility":"show","key":"SO6aENVF9g"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport seaborn as sns\n","visibility":"hide","key":"XIVr1dh1ZR"},{"type":"output","id":"zaTS5MSRPnTekX9rpHjS6","data":[],"visibility":"show","key":"JY9PlArooa"}],"visibility":"show","key":"oXt8cGjUGR"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"df= pd.read_csv(\"../output/scenes_data.tsv\", sep='\\t')","visibility":"hide","key":"sYXeojhFPj"},{"type":"output","id":"plgBrs3gZaD54UzKIaY3_","data":[],"visibility":"show","key":"NgK0ze730a"}],"visibility":"show","key":"CbHj6E7JlF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"df[\"season\"] = df[\"episode\"].str.extract(r's(\\d+)', expand=False).astype(int)\ndf[\"episode_short\"] = df[\"episode\"].str.extract(r'(s\\d+e\\d+)', expand=False).str.upper()\nmean_duration = df.groupby(\"episode_short\", as_index=False)[\"duration\"].mean()\n","visibility":"hide","key":"ZayMMcZrmQ"},{"type":"output","id":"BQOutIjbNNwcrNYHJIkzZ","data":[],"visibility":"show","key":"lx3Yt26WMV"}],"visibility":"show","key":"FJvc8sFJU9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AVERAGE DURATION üï∞Ô∏è OF SEGMENTS PER EPISODES","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IdJmBDomtQ"}],"identifier":"average-duration-of-segments-per-episodes","label":"AVERAGE DURATION üï∞Ô∏è OF SEGMENTS PER EPISODES","html_id":"average-duration-of-segments-per-episodes","implicit":true,"key":"ISKQpc27qs"}],"key":"wwZsyOnCox"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(20, 8))\nax = sns.barplot(data=mean_duration, x=\"episode_short\", y=\"duration\", palette=\"viridis\")\nax.set_xticks(ax.get_xticks()[::5])  # show every 5th label\nax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha=\"right\")\nplt.title(\"Average duration of scenes per episode\")\nplt.ylabel(\"Average duration (s)\")\nplt.xlabel(\"Episodes\")\nplt.tight_layout()\nplt.show()\n","visibility":"hide","key":"OV2MPhLGiT"},{"type":"output","id":"I8R_J7v2Rg__v538TXJCq","data":[{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_8030/3446811800.py:2: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  ax = sns.barplot(data=mean_duration, x=\"episode_short\", y=\"duration\", palette=\"viridis\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"23a3213bb4ebe1376f0dd00458781668","path":"/23a3213bb4ebe1376f0dd00458781668.png"},"text/plain":{"content":"<Figure size 2000x800 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"HL8qU6H7jZ"}],"visibility":"show","key":"UwanV8r3VW"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"\nscene_count = df.groupby(\"episode_short\")[\"scene_number\"].count().reset_index(name=\"num_scenes\")","visibility":"hide","key":"h6rWOeN5SG"},{"type":"output","id":"7zWZE2zCpinFP_H6ZZpkf","data":[],"visibility":"show","key":"YkfESBxhE7"}],"visibility":"show","key":"hCh1HmoPm7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"NUMBER OF SCENES üß© IN EPISODES","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QsKaYyBrG7"}],"identifier":"number-of-scenes-in-episodes","label":"NUMBER OF SCENES üß© IN EPISODES","html_id":"number-of-scenes-in-episodes","implicit":true,"key":"wt0ctLslAm"}],"key":"jiRQycn5os"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(20, 8))\nax = sns.barplot(data=scene_count, x=\"episode_short\", y=\"num_scenes\", palette=\"viridis\")\nax.set_xticks(ax.get_xticks()[::5])  # show every 5th label\nax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha=\"right\")\nax.set_yticks(range(0, 500, 50)) \nplt.title(\"n of scenes per episode\")\nplt.ylabel(\" n of scenes\")\nplt.xlabel(\"Episodes\")\nplt.tight_layout()\nplt.show()","visibility":"hide","key":"He4IkRfJ05"},{"type":"output","id":"saavWQtV5bhlI7thNz4bW","data":[{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_8030/441019428.py:2: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  ax = sns.barplot(data=scene_count, x=\"episode_short\", y=\"num_scenes\", palette=\"viridis\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"32b0d2dfbed59dc6dfe0fb1bdf5481ea","path":"/32b0d2dfbed59dc6dfe0fb1bdf5481ea.png"},"text/plain":{"content":"<Figure size 2000x800 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"byGqGRpcue"}],"visibility":"show","key":"BpixeRkKvc"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"episode_durations = df.groupby(\"episode_short\")[\"duration\"].sum().reset_index(name=\"episode_duration\")","visibility":"hide","key":"cXomWrtNNU"},{"type":"output","id":"TxjJ0FiruSMnxrUsJAdpV","data":[],"visibility":"show","key":"tigmUpORNv"}],"visibility":"show","key":"DjwUqXm1XO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"DURATION OF EPISODES üï∞Ô∏è","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YvHbcBNA4n"}],"identifier":"duration-of-episodes","label":"DURATION OF EPISODES üï∞Ô∏è","html_id":"duration-of-episodes","implicit":true,"key":"pFoF0rE92l"}],"key":"m0AZMpgGrL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(20, 8))\nax = sns.barplot(data=episode_durations, x=\"episode_short\", y=\"episode_duration\", palette=\"viridis\")\nax.set_xticks(ax.get_xticks()[::5])  # show every 5th label\nax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha=\"right\")\nplt.title(\"Duration of episodes\")\nplt.ylabel(\"Duration (s)\")\nplt.xlabel(\"Episodes\")\nplt.tight_layout()\nplt.show()\n","visibility":"hide","key":"FqEHdMpTos"},{"type":"output","id":"VSJkQwrNpK-dy2XcMPEzH","data":[{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_8030/1315073239.py:2: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  ax = sns.barplot(data=episode_durations, x=\"episode_short\", y=\"episode_duration\", palette=\"viridis\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6e43ac1e4995d44fb2c246dcac67cc08","path":"/6e43ac1e4995d44fb2c246dcac67cc08.png"},"text/plain":{"content":"<Figure size 2000x800 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"OBKVnI2ekk"}],"visibility":"show","key":"PFhs7hTWdx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"SCENES DURATIONS üï∞Ô∏è","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Bsc1f4D7Wy"}],"identifier":"scenes-durations","label":"SCENES DURATIONS üï∞Ô∏è","html_id":"scenes-durations","implicit":true,"key":"EvCkgPbgs8"}],"key":"m6chf2UeDk"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport plotly.graph_objects as go\n\n# Sort seasons\nseasons = sorted(df['season'].unique())\n\n# Create figure\nfig = go.Figure()\nall_traces = []\n\n# Track how many episodes per season (for visibility masks)\nseason_trace_counts = []\n\n# Create violin traces for each season's episodes\nfor season in seasons:\n    filtered_df = df[df['season'] == season]\n    episodes = sorted(filtered_df['episode_short'].unique())\n    trace_count = 0\n    \n    for ep in episodes:\n        ep_df = filtered_df[filtered_df['episode_short'] == ep]\n\n        trace = go.Violin(\n            x=[ep] * len(ep_df),\n            y=ep_df['duration'],\n            name=f\"Ep {ep}\",\n            box_visible=True,\n            meanline_visible=True,\n            points=\"all\",\n            visible=(season == seasons[0]),  # Only show first season initially\n            customdata=ep_df[['global_scene_number', 'duration']].values,\n            hovertemplate=(\n                \"Episode: %{x}<br>\" +\n                \"Global scene: %{customdata[0]}<br>\" +\n                \"Duration: %{customdata[1]} seconds<br>\" +\n                \"<extra></extra>\"  # hides the trace name in the tooltip\n    )\n)\n        fig.add_trace(trace)\n        trace_count += 1\n\n    season_trace_counts.append(trace_count)\n\n# Compute visibility masks for each season\n# Compute visibility masks for each season\nvisibility_masks = []\ntotal_traces = sum(season_trace_counts)\nstart = 0\nfor count in season_trace_counts:\n    mask = [False] * total_traces\n    for i in range(count):\n        mask[start + i] = True\n    visibility_masks.append(mask)\n    start += count\n\n\n# Create dropdown buttons\ndropdown_buttons = [\n    dict(\n        label=f\"Season {season}\",\n        method=\"update\",\n        args=[\n            {\"visible\": visibility_masks[i]},\n            {\"title\": f\"Scene Duration ‚Äì Season {season}\"}\n        ]\n    )\n    for i, season in enumerate(seasons)\n]\n\n# Update layout\nfig.update_layout(\n    updatemenus=[\n        dict(\n            active=0,\n            buttons=dropdown_buttons,\n            x=0.1,\n            y=1.15,\n            xanchor=\"left\",\n            yanchor=\"top\"\n        )\n    ],\n    title=f\"Scene Duration ‚Äì Season {seasons[0]}\",\n    xaxis_title=\"Episode\",\n    yaxis_title=\"Duration (seconds)\",\n    width=1200,\n    height=600,\n    showlegend=False\n)\n\nfig.show()\n","visibility":"hide","key":"q0vFqJeKLi"},{"type":"output","id":"raiabznrTOQctHRFKf0LD","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.plotly.v1+json":{"content_type":"application/vnd.plotly.v1+json","hash":"e53aae783566c3c89a7d0a8c97ac70e1","path":"/e53aae783566c3c89a7d0a8c97ac70e1.json"},"image/png":{"content_type":"image/png","hash":"9b662676bc06f64d23413043192abd3f","path":"/9b662676bc06f64d23413043192abd3f.png"}}}],"visibility":"show","key":"Yq1gnyVm30"}],"visibility":"show","key":"Ef0oFnFuVq"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport plotly.graph_objects as go\n\n# Sort seasons\nseasons = sorted(df['season'].unique())\n\n# Create figure\nfig = go.Figure()\nseason_trace_count = []\n\n# Add one scatter trace per season\nfor i, season in enumerate(seasons):\n    filtered_df = df[df['season'] == season]\n\n    trace = go.Scatter(\n        x=filtered_df['global_scene_number'],\n        y=filtered_df['duration'],\n        mode='markers',\n        name=f\"Season {season}\",\n        customdata=filtered_df[['episode_short', 'scene_number']],\n        hovertemplate=(\n            \"Global Scene: %{x}<br>\" +\n            \"Duration: %{y} seconds<br>\" +\n            \"Episode: %{customdata[0]}<br>\" +\n            \"Scene: %{customdata[1]}<br>\" +\n            \"<extra></extra>\"\n        ),\n        visible=(i == 0)  # Only show first season initially\n    )\n    fig.add_trace(trace)\n\n# Create visibility masks for dropdown\nvisibility_masks = [\n    [i == j for i in range(len(seasons))]\n    for j in range(len(seasons))\n]\n\n# Create dropdown buttons\ndropdown_buttons = [\n    dict(\n        label=f\"Season {season}\",\n        method=\"update\",\n        args=[\n            {\"visible\": visibility_masks[i]},\n            {\"title\": f\"Scene Duration ‚Äì Season {season}\"}\n        ]\n    )\n    for i, season in enumerate(seasons)\n]\n\n# Update layout\nfig.update_layout(\n    updatemenus=[\n        dict(\n            active=0,\n            buttons=dropdown_buttons,\n            x=0.1,\n            y=1.2,\n            xanchor=\"left\",\n            yanchor=\"top\"\n        )\n    ],\n    title=f\"Scene Duration ‚Äì Season {seasons[0]}\",\n    xaxis_title=\"Global Scene Number\",\n    yaxis_title=\"Duration (seconds)\",\n    width=1200,\n    height=600\n)\n\nfig.show()\n","visibility":"hide","key":"FVW47SCIuS"},{"type":"output","id":"822t6XnPx4rN9Mytb5Zhd","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.plotly.v1+json":{"content_type":"application/vnd.plotly.v1+json","hash":"1aad38f6acf64d10a3d8868b4a9588e7","path":"/1aad38f6acf64d10a3d8868b4a9588e7.json"},"image/png":{"content_type":"image/png","hash":"2a0ff76653a16e9a4090509a6bc1254c","path":"/2a0ff76653a16e9a4090509a6bc1254c.png"}}}],"visibility":"show","key":"Lb8Ty6toy3"}],"visibility":"show","key":"DilQF1ULbX"}],"key":"lchEeeX0Ky"},"references":{"cite":{"order":[],"data":{}}}}